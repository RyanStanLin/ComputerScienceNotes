# Interrupts (中断)

## Interrupt Handling (中断处理)

### What are interrupts? (什么是中断？)

> [!IMPORTANT]
> An **interrupt (中断)** is a signal sent to the **processor (处理器)** that temporarily stops its current task to handle a higher-priority event. It allows the system to respond to hardware events or time-sensitive tasks efficiently.

When an interrupt occurs, the processor **suspends (暂停)** the current program's execution and transfers control to a specific routine called an **Interrupt Service Routine (ISR) (中断服务程序)**.

### Purpose and role of interrupts (中断的目的和作用)

Interrupts are fundamental for modern operating systems to manage the computer's resources effectively.

-   **Real-time Event Handling (实时事件处理)**: Responding immediately to critical events.
    -   *Examples*: Hardware errors like a hard disk failure, signals from input devices.
-   **Device Communication (设备通信)**: Managing asynchronous signals from external devices.
    -   *Examples*: Printer jams, network packet arrival, or a mouse click.
-   **Multitasking (多任务处理)**: Facilitating the switching between different applications or processes, which is managed by a **scheduler (调度程序)** that is often triggered by a timer interrupt.

---

### Types of interrupts (中断的类型)

> [!WARNING]
> While it's useful to know the categories, ALevel exams more commonly ask for *examples* of interrupts rather than asking you to classify them.

| Type (类型) | Definition (定义) | Example (示例) |
| --- | --- | --- |
| **Hardware Interrupts (硬件中断)** | Generated by an external hardware device signalling that it needs attention from the OS. | Keyboard input, mouse movements, disk I/O requests, timer signal. |
| **Software Interrupts (软件中断)** | Triggered by a software instruction or a condition within the program. | An application requesting to open a file, or an error condition like division by zero. |
| **Trap Interrupts (陷阱中断)** | Intentionally triggered by a user program to request a service from the operating system. | Used for software debugging or handling specific error cases in a controlled manner. |

## The Interrupt Process (中断过程)

![img](https://cdn.savemyexams.com/cdn-cgi/image/f=auto,width=3840/https://cdn.savemyexams.com/uploads/2023/08/the-interrupt-process-alevel.png)

The handling of an interrupt follows a precise sequence of steps known as the **interrupt handling cycle (中断处理周期)**.

> [!TIP]
> 💡 This is a very common exam question. You should memorize these steps in order.

1.  **Interrupt Request (IRQ) (中断请求)**
    *   An external device or an internal event generates an interrupt signal.
    *   This signal is sent to the **Interrupt Controller (中断控制器)**, which prioritizes it and forwards it to the processor if appropriate.

2.  **Interrupt Acknowledge and State Saving (中断确认与状态保存)**
    *   The processor finishes its current Fetch-Decode-Execute cycle instruction.
    *   It checks the priority of the interrupt. If it's of a higher priority than the current task, it acknowledges the interrupt.
    *   <ins>The current contents of the **Program Counter (PC)** and other key **registers (寄存器)** (like the Accumulator) are saved onto the **system stack (系统堆栈)**.</ins> This is critical to ensure the original process can be resumed later without losing its state.

3.  **Interrupt Service Routine (ISR) Lookup (查找中断服务程序)**
    *   The processor identifies the source of the interrupt.
    *   <ins>The processor uses the interrupt's unique number to look up the address of the corresponding ISR in a special table in memory called the **Interrupt Vector Table (IVT)**.</ins>
    *   The address of the correct ISR is loaded into the **Program Counter (PC)**.

4.  **ISR Execution (执行中断服务程序)**
    *   The processor begins executing the instructions in the ISR.
    *   The ISR handles the specific event (e.g., reads the keyboard buffer, sends an error message).

5.  **Interrupt Exit and State Restoration (中断退出与状态恢复)**
    *   Once the ISR has completed, the saved state from the stack is **restored (恢复)**.
    *   The values from the stack are popped back into the PC and other registers.
    *   The original process resumes execution from where it was interrupted, continuing the Fetch-Decode-Execute cycle.

## Interrupt Service Routine (ISR) (中断服务程序)

### What is an ISR? (什么是 ISR？)

> [!IMPORTANT]
> An **Interrupt Service Routine (ISR)**, or interrupt handler, is a special function or block of code designed to handle a specific type of interrupt.

-   Each type of interrupt has a corresponding ISR.
    -   *Examples*: A printer jam, a hard disk failure, a file download error, or a network connection error all have their own specific routines to be followed.
-   ISRs should be concise, efficient, and carefully designed to minimise their execution time, as they often handle time-sensitive events and block other interrupts (of lower priority) from being processed.

## Interrupt Priority and Nesting (中断优先级与嵌套)

### Interrupt Priority Handling (中断优先级处理)

![img](https://cdn.savemyexams.com/cdn-cgi/image/f=auto,width=3840/https://cdn.savemyexams.com/uploads/2023/08/system-interrupt-priority-alevel.png)

-   **Interrupt prioritisation (中断优先级)** allows the processor to differentiate between urgent and non-urgent interrupts.
-   Prioritising interrupts is vital because multiple interrupts can occur simultaneously. A high-priority interrupt (e.g., power failure) must be handled before a low-priority one (e.g., keyboard input).
-   Lower-priority interrupts are ignored until any higher-priority interrupts have been fully serviced.

---

### Nesting of Interrupts (中断嵌套)

-   **Nesting of interrupts (中断嵌套)** refers to the ability of the processor to handle a new, higher-priority interrupt while it is already servicing a lower-priority one.
-   If a new interrupt with a higher priority occurs while a lower-priority ISR is running, the processor will <ins>pause the current ISR (saving its state to the stack) and begin executing the new, higher-priority ISR</ins>.
-   Once the higher-priority ISR is complete, the state of the lower-priority ISR is restored, and its execution resumes.
-   Proper management of nested interrupts is crucial for avoiding potential conflicts and ensuring system stability, especially in complex real-time systems.
